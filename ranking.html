<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실시간 순위 시스템</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 15px; background-color: #f4f4f8; }
        .container { max-width: 800px; margin: auto; }
        
        /* ⭐️ 1. 로고 스타일 추가 ⭐️ */
        .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .logo-container img {
            max-width: 450px; /* 로고 최대 너비 (이 값 조절) */
            height: auto; /* 높이는 자동으로 조절 */
        }

        h1 { text-align: center; }
        .filters { display: flex; gap: 10px; margin-bottom: 20px; }
        .filters select { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }
        table { width: 100%; border-collapse: collapse; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }
        th { background-color: #f2f2f2; }
        tr.award-top10 { background-color: #d4edda; font-weight: bold; }
        tr.award-top5 { background-color: #fff3cd; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <img src="https://github.com/seanyjeong/supermax12/blob/main/%EC%8A%88%EB%A7%A512%EB%A1%9C%EA%B3%A0.png?raw=true" alt="슈퍼맥스12 로고">
        </div>

     
        <div class="filters">
            <select id="class-type" onchange="fetchRankings()">
                <option value="선행반">선행반 (1,2학년)</option>
                <option value="입시반">입시반 (3학년)</option>
                <option value="N수반">N수반</option>
            </select>
            <select id="event" onchange="fetchRankings()">
                <option value="종합">종합 순위</option>
                <option value="제멀">제자리멀리뛰기</option>
                <option value="10m">10m 왕복달리기</option>
                <option value="메디신볼">메디신볼 던지기</option>
                <option value="배근력">배근력</option>
            </select>
            <select id="gender" onchange="fetchRankings()">
                <option value="남">남자</option>
                <option value="여">여자</option>
            </select>
        </div>
        <table>
            <thead>
                <tr>
                    <th>순위</th>
                    <th>수험번호</th>
                    <th>이름</th>
                    <th id="score-header">점수</th>
                </tr>
            </thead>
            <tbody id="rankings-body"></tbody>
        </table>
    </div>

    <script>
        const API_URL = 'https://supermax.kr';

        // ⭐️ 기록 포맷팅을 위한 헬퍼 함수 추가
        function formatRecord(event, recordValue) {
            if (recordValue === null || recordValue === undefined) return '-';
            const recordNum = parseFloat(recordValue);
            let formattedRecord;

            switch (event) {
                case '제멀':
                    formattedRecord = `${recordNum.toFixed(0)} cm`;
                    break;
                case '메디신볼':
                    formattedRecord = `${recordNum.toFixed(1)} m`;
                    break;
                case '10m':
                    formattedRecord = `${recordNum.toFixed(1)} 초`;
                    break;
                case '배근력':
                    formattedRecord = `${recordNum.toFixed(1)} kg`;
                    break;
                default:
                    formattedRecord = recordValue;
            }
            return formattedRecord;
        }

        async function fetchRankings() {
            const classType = document.getElementById('class-type').value;
            const event = document.getElementById('event').value;
            const gender = document.getElementById('gender').value;
            const tbody = document.getElementById('rankings-body');
            const scoreHeader = document.getElementById('score-header');
            tbody.innerHTML = `<tr><td colspan="4">로딩 중...</td></tr>`;

            // ⭐️ 선택된 종목에 따라 테이블 헤더 변경
            scoreHeader.textContent = (event === '종합') ? '점수' : '기록';

            try {
                const response = await fetch(`${API_URL}/26susi/rankings?classType=${classType}&gender=${gender}&event=${event}`);
                const result = await response.json();

                if (!result.success || result.data.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="4">해당 조건의 데이터가 없습니다.</td></tr>`;
                    return;
                }

                let htmlRows = '';
                result.data.forEach(item => {
                    let awardClass = '';
                    const awardLimit = (classType === 'N수반') ? 5 : 10;
                    if (item.ranking <= awardLimit) {
                        awardClass = (classType === 'N수반') ? 'award-top5' : 'award-top10';
                    }
                    
                    // ⭐️ 표시할 값을 '종합'과 '종목별'로 분기 처리
                    const displayValue = (event === '종합')
                        ? `${item.score}점`
                        : formatRecord(event, item.record_value);

                    htmlRows += `
                        <tr class="${awardClass}">
                            <td>${item.ranking}위</td>
                            <td>${item.exam_number || item.branch_name}</td>
                            <td>${item.student_name}</td>
                            <td>${displayValue}</td>
                        </tr>
                    `;
                });
                tbody.innerHTML = htmlRows;
            } catch (error) {
                tbody.innerHTML = `<tr><td colspan="4">데이터를 불러오는 중 오류가 발생했습니다.</td></tr>`;
            }
        }
        window.onload = fetchRankings;
    </script>
</body>
</html>